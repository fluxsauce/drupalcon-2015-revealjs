<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8"/>
	<title>The Great Consolidation: Entertainment Weekly Migration Case Study | DrupalCon LA 2015</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
	<link rel="stylesheet" href="css/reveal.css"/>
	<link rel="stylesheet" href="css/theme/drupalcon_la2015.css" id="theme"/>
	<link rel="stylesheet" href="css/theme/ew.css"/>
	<link rel="shortcut icon" href="favicon.ico"/>
</head>
<body>
<div class="reveal">
	<div class="slides">
		<section>
			<section data-state="laback">
				<img src="assets/masthead2logo.png" alt="">
				<h1 class="title">The Great Consolidation:<br/>Entertainment Weekly Migration Case Study</h1>
				<h4 class="subtitle">Jon Peck, Matt Grill, Preston So</h4>
				<p class="bottom">Slides: <a href="http://goo.gl/qJi8Kl">http://goo.gl/qJi8Kl</a></p>
			</section>
			<section>
				<h1>Who are we?</h1>
				<div class="left">
					<img class="bare" src="assets/4klogo.png" alt="Four Kitchens Logo"><br/>
				</div>
				<div class="right">
					<img class="bare" src="assets/timeinclogo.png" alt="Time Inc. Logo">
				</div>
				<ul>
					<li class="fragment">Jon Peck - <a href="https://www.drupal.org/u/fluxsauce">drupal.org/u/fluxsauce</a></li>
					<li class="fragment">Matt Grill - <a href="https://www.drupal.org/u/drpal">drupal.org/u/drpal</a></li>
					<li class="fragment">Preston So - <a href="https://www.drupal.org/u/prestonso">drupal.org/u/prestonso</a></li>
				</ul>
			</section>
		</section>
		<section>
			<section data-state="laback">
				<img src="assets/masthead2logo.png" alt="">
				<div class="title-block">
					<h1>Project overview</h1>
					<h4 class="subtitle">What did we do &amp; who did it?</h4>
				</div>
			</section>
			<section>
				<h1>Entertainment Weekly</h1>
				<div class="left">
					<ul>
						<li class="fragment">Entertainment news magazine</li>
						<li class="fragment">40th largest in the US</li>
						<li class="fragment">ew.com serves 13.7 million consumers per week</li>
					</ul>
				</div>
				<div class="right">
					<img src="assets/ewdotcom-front.png" alt="ew.com front page">
					<p class="caption">Front page of EW.com</p>
				</div>
				<aside class="notes">
					<p>Magazine that covers film, TV, music, Broadway theater, books, and pop culture</p>
					<p>13.7 million across desktop, tablet &amp; mobile</p>
				</aside>
			</section>
			<section>
				<h1>Migration scope</h1>
				<div class="left">
					<h2 class="subtitle fragment">WordPress</h2>
					<ul>
						<li class="fragment"><strong>10</strong> blogs</li>
						<li class="fragment"><strong>51,616</strong> terms</li>
						<li class="fragment"><strong>101,581</strong> posts</li>
						<li class="fragment"><strong>90,435</strong> images</li>
					</ul>
				</div>
				<div class="right">
					<h2 class="subtitle fragment">Vignette V6</h2>
					<ul>
						<li class="fragment"><strong>117,326</strong> articles</li>
						<li class="fragment"><strong>201,986</strong> images</li>
						<li class="fragment"><strong>97,611</strong> terms</li>
						<li class="fragment"><strong>4,924</strong> galleries
						</li>
					</ul>
				</div>
			</section>
			<section>
				<h1>Development Teams</h1>
				<ul>
					<li class="fragment"><strong>Four Kitchens</strong> - 3 to 6 developers</li>
					<li class="fragment"><strong>Time Inc.</strong> - 1 to 4 developers</li>
					<li class="fragment">Zoom, HipChat for regular communication</li>
					<li class="fragment">Video really helps</li>
					<li class="fragment">
						<a href="http://fourword.fourkitchens.com/article/bringing-smiles-pull-requests-github-selfies">GitHub Selfies</a> improved morale
					</li>
				</ul>
				<div class="right fragment">
					<img src="assets/ghselfies.gif" alt="GitHub Selfies">
				</div>
			</section>
			<section>
				<h1>Timeline</h1>
				<img src="assets/codefreq.png" alt="code frequency">
				<ul>
					<li class="fragment">First commit: April 29th, 2014</li>
					<li class="fragment">Launch: January 29th, 2015</li>
					<li class="fragment">17 sprints</li>
				</ul>
			</section>
			<section>
				<h1>Delegation of responsibilities</h1>
				<div class="left">
					<h2 class="subtitle fragment">Four Kitchens</h2>
					<ul>
						<li class="fragment">Project Management</li>
						<li class="fragment">Data structures</li>
						<li class="fragment">Migration</li>
						<li class="fragment">Implement design, advertising</li>
					</ul>
				</div>
				<div class="right">
					<h2 class="subtitle fragment">Time Inc.</h2>
					<ul>
						<li class="fragment">Product Owner</li>
						<li class="fragment">Design</li>
						<li class="fragment">Workflow</li>
						<li class="fragment">Infrastructure, build process</li>
					</ul>
				</div>
			</section>
		</section>
		<section>
			<section data-state="laback">
				<img src="assets/masthead2logo.png" alt="">
				<div class="title-block">
					<h1>Process</h1>
					<h4 class="subtitle">Standards and documentation</h4>
				</div>
			</section>
			<section>
				<h1>Definition of Readiness and Completion</h1>
				<ul>
					<li class="fragment">Stakeholders: <span class="fragment">Context necessary for development</span></li>
					<li class="fragment">Developers: <span class="fragment">Reviews, PO acceptance, demo, docs</span></li>
					<li class="fragment">Evolving framework</li>
				</ul>
			</section>
			<section>
				<h1>Code and style standards</h1>
				<h2 class="subtitle">Algorithmically enforced</h2>
				<ul>
					<li class="fragment"><a href="https://github.com/squizlabs/PHP_CodeSniffer">PHP_CodeSniffer</a> with Drupal rules from <a href="https://www.drupal.org/project/coder">coder</a></li>
					<li class="fragment"><a href="http://jshint.com/">jshint</a> syntax and errors</li>
					<li class="fragment"><a href="http://jscs.info/">jscs</a> code style</li>
					<li class="fragment"><a href="http://editorconfig.org/">EditorConfig</a> settings</li>
				</ul>
			</section>
			<section>
				<h1>Commit and pull request workflow</h1>
				<ul>
					<li class="fragment">Descriptive commit messages</li>
					<li class="fragment">Robust testing instructions</li>
					<li class="fragment">Pull request labels</li>
				</ul>
			</section>
			<section>
				<h1>Peer code reviews</h1>
				<h2 class="subtitle">Code review: does it...</h2>
				<ul>
					<li class="fragment">Pass code and style standards?</li>
					<li class="fragment">Accomplish the task gracefully?</li>
					<li class="fragment">Perform at an optimal level?</li>
				</ul>
			</section>
			<section>
				<h1>Peer code reviews</h1>
                                <h2 class="subtitle">Functional review: does it...</h2>
				<ul>
					<li class="fragment">Fulfill the intent of the story?</li>
					<li class="fragment">Use best practices?</li>
					<li class="fragment">Avoid technical debt?</li>
				</ul>
			</section>
			<section>
				<h1>Development Environments</h1>
				<ul>
					<li class="fragment">Documented project-specific process</li>
					<li class="fragment">Greatly reduced on-boarding time</li>
					<li class="fragment">Provided detailed feedback</li>
				</ul>
			</section>
			<section>
				<h1>Branching standard</h1>
				<ul>
					<li class="fragment">Reduces clutter, helps manage releases</li>
					<li class="fragment">Improves communication, navigation</li>
					<li class="fragment"><code>sprint-XX</code> (kept for one sprint)</li>
					<li class="fragment"><code>PROJECT-YY</code> (deleted after merge)</li>
					<li class="fragment">Tags added when deleting sprint branch</li>
				</ul>
			</section>
		</section>
		<section>
			<section data-state="laback">
				<img src="assets/masthead2logo.png" alt="">
				<div class="title-block">
					<h1>Front-end</h1>
					<h4 class="subtitle">Theming, performance and advertising</h4>
				</div>
			</section>
			<section>
				<h1>Aurora, mobile first theming</h1>
				<ul>
					<li class="fragment">Separate themes hard requirement</li>
					<li class="fragment">Edge device detection set cookie</li>
					<li class="fragment"><code>theme_key</code> switched theme using cookie</li>
					<li class="fragment">Used <code>Aurora</code> as base theme</li>
					<li class="fragment">HTML5, Sass &amp; Compass</li>
					<li class="fragment">Mobile theme is sub-theme of Aurora</li>
					<li class="fragment">Desktop is a sub-theme of Mobile</li>
				</ul>
			</section>
			<section>
				<h1>Gulp task management</h1>
				<div class="left">
					<ul>
						<li class="fragment">Compiles Sass</li>
						<li class="fragment">Runs JavaScript checkers</li>
						<li class="fragment">Watches for changes</li>
					</ul>
				</div>
				<div class="right"><img src="assets/gulp.png" alt="gulp"/></div>
				<aside class="notes">jshint for quality, jscs for style</aside>
			</section>
			<section>
				<h1>JavaScript global scoping</h1>
				<div class="left"><img src="assets/jsglobal.png" alt="Global JavaScript object"/></div>
				<div class="right">
					<ul>
						<li class="fragment">Created global JS object for all EW functions</li>
						<li class="fragment">Centralized point of entry</li>
						<li class="fragment">Easy access</li>
					</ul>
				</div>
			</section>
			<section>
				<h1>Atomic JavaScript functionality</h1>
				<div class="left">
					<ul>
						<li class="fragment">Break related functions into individual files</li>
						<li class="fragment">Only load what’s needed</li>
						<li class="fragment">Improves front-end performance</li>
					</ul>
				</div>
				<div class="right"><img src="assets/radiation.png" alt="Radiation"/></div>
				<aside class="notes">No monolithic structure, so reducing page weight</aside>
			</section>
			<section>
				<h1>Pre-processing</h1>
				<ul>
					<li class="fragment">Node template data built in pre-processing</li>
					<li class="fragment">Clean &amp; reusable</li>
					<li class="fragment">Helper and abstractions</li>
				</ul>
				<aside class="notes">Balancing performance with business logic</aside>
			</section>
			<section>
				<h1>Global metadata object</h1>
				<ul>
					<li class="fragment">Useful for integrations requiring metadata</li>
					<li class="fragment">Avoids repetition</li>
					<li class="fragment">Facilitates data collection by crawlers</li>
				</ul>
			</section>
			<section>
				<h1>Beacon performance</h1>
				<ul>
					<li class="fragment">Delay loading of beacons (non-blocking/defer)</li>
					<li class="fragment">Use defer for injecting JS tags</li>
				</ul>
			</section>
			<section>
				<h1>Ad performance</h1>
				<ul>
					<li class="fragment">No ad specific logic in templates</li>
					<li class="fragment">Data attributes contain relevant values</li>
					<li class="fragment">Avoids inline JS</li>
					<li class="fragment">Ads process and render in footer (after page load)</li>
				</ul>
			</section>
		</section>
		<section>
			<section data-state="laback">
				<img src="assets/masthead2logo.png" alt="">
				<div class="title-block">
					<h1>Editorial UI &amp; Workflow</h1>
				</div>
			</section>
			<section>
				<h1>Packages and Channels</h1>
				<ul>
					<li class="fragment">Automatic dynamic content</li>
					<li class="fragment">Editors define rules for selection</li>
					<li class="fragment">Optional manual curation</li>
				</ul>
			</section>
			<section>
				<h1>Custom content types</h1>
				<ul>
					<li class="fragment">Used existing TI features to begin</li>
					<li class="fragment">Rounds of PO, editor feedback</li>
					<li class="fragment">Usability key to adoption</li>
				</ul>
			</section>
			<section>
				<h1>Dynamic Entity References</h1>
				<ul>
					<li class="fragment">Many aggregate views</li>
					<li class="fragment">Editorial control of views, but with overrides</li>
					<li class="fragment">Custom module that “fills in” empty parts of a view based on context</li>
					<li class="fragment">View lists 15, editor defines 5, DER  populates remaining</li>
				</ul>
			</section>
			<section>
				<h1>Dynamic ER challenges</h1>
				<ul>
					<li class="fragment">Modular, extensible, reusable</li>
					<li class="fragment">Accurate dynamically curated nodes</li>
					<li class="fragment">High performance</li>
					<li class="fragment">Editorial expectations for caching</li>
					<li class="fragment">State Machine integration</li>
				</ul>
			</section>
		</section>
		<section>
			<section data-state="laback">
				<img src="assets/masthead2logo.png" alt="">
				<div class="title-block">
					<h1>Content migrations</h1>
					<h4 class="subtitle">WordPress, Vignette to Drupal</h4>
				</div>
			</section>
			<section>
				<h1>WordPress Challenges</h1>
				<ul>
					<li class="fragment">10 different blogs, structures, taxonomies</li>
					<li class="fragment">Invalid markup</li>
					<li class="fragment">Custom shortcodes, filters</li>
				</ul>
				<aside class="notes">Interviewed other teams</aside>
			</section>
			<section>
				<h1 style="font-size: .7em;">wordpress_migrate not enough...</h1>
				<h2 class="subtitle fragment">But still useful!</h2>
				<ul>
					<li class="fragment">Extended classes</li>
					<li class="fragment">Helped normalize WXR structure</li>
					<li class="fragment"><i>Really just XML</i></li>
					<li class="fragment">Focus on custom logic</li>
				</ul>
			</section>
			<section>
				<h1>WordPress pre-processing</h1>
				<ul>
					<li class="fragment">Stripped comments</li>
					<li class="fragment">Transformed identifiers</li>
					<li class="fragment">Separated authors, images, tags</li>
				</ul>
			</section>
			<section>
				<h1>WordPress shortcodes, filters</h1>
				<ul>
					<li class="fragment">Implemented subset of shortcodes in Drupal</li>
					<li class="fragment">Most not migrated</li>
					<li class="fragment">Rendered as HTML in pre-processing</li>
					<li class="fragment">Used WordPress libraries, existing code</li>
					<li class="fragment">Faked WordPress bootstrap to execute natively</li>
				</ul>
			</section>
			<section>
				<h1>Mapping WordPress tags on import</h1>
				<ul>
					<li class="fragment">Specific vocabularies</li>
					<li class="fragment">New content types (people, creative works)</li>
					<li class="fragment">CSV Spreadsheet used for defining rules</li>
				</ul>
			</section>
			<section>
				<h1>Exporting from Vignette</h1>
				<ul>
					<li class="fragment">Rendered as XML files</li>
					<li class="fragment">Most procs were rendered as HTML</li>
					<li class="fragment">Transformed overloaded taxonomies to content</li>
				</ul>
			</section>
			<section>
				<h1>Improving migration performance</h1>
				<ul>
					<li class="fragment">Validate all XML before ingestion</li>
					<li class="fragment">Eliminate all PHP errors, warnings</li>
					<li class="fragment">Avoid redundant migrations</li>
					<li class="fragment">Use <code>cache_counts</code></li>
				</ul>
			</section>
			<section>
				<h1>Reducing migration overhead</h1>
				<ul>
					<li class="fragment">Disabled solr, pathauto, metatag, others during migration</li>
					<li class="fragment">Indexing lookup tables</li>
					<li class="fragment">Ran migrations in parallel</li>
					<li class="fragment">Ensure HW resources are sufficient</li>
				</ul>
			</section>
			<section>
				<h1>Redirect strategy</h1>
				<ul>
					<li class="fragment">Minimize Drupal performing redirects</li>
					<li class="fragment">Redirect farm (rules, 1:1 redirects)</li>
					<li class="fragment">DNS changes</li>
					<li class="fragment">Redirects from migrated servers</li>
				</ul>
			</section>
		</section>
		<section>
			<section data-state="laback">
				<img src="assets/masthead2logo.png" alt="">
				<div class="title-block">
					<h1>Performance and caching</h1>
				</div>
			</section>
			<section>
				<h1>Frontend performance</h1>
				<ul>
					<li class="fragment">CSS is Sass and Compass optimized</li>
					<li class="fragment">Targeted - only load needed CSS</li>
					<li class="fragment">JavaScript is linted, strict standards</li>
					<li class="fragment">JS in the footer (non-blocking)</li>
				</ul>
				<aside class="notes">Interviewed other teams</aside>
			</section>
			<section>
				<h1>Frontend caching strategy</h1>
				<ul>
					<li class="fragment">Editorial 1 minute publish to live</li>
					<li class="fragment">Ensure cacheable headers are set</li>
					<li class="fragment">Shorter TTL on Akamai than Varnish</li>
					<li class="fragment">Send purges on publishing</li>
				</ul>
			</section>
			<section>
				<h1>Backend performance</h1>
				<ul>
					<li class="fragment">Eliminate PHP errors</li>
					<li class="fragment">Cache, EXPLAIN custom queries</li>
					<li class="fragment">Minimize unnecessary overhead</li>
					<li class="fragment">Module count</li>
					<li class="fragment">Benchmarking</li>
				</ul>
			</section>
			<section>
				<h1>Performance testing</h1>
				<ul>
					<li class="fragment">Load test production with migrated data</li>
					<li class="fragment">Blitz.io and custom tooling</li>
					<li class="fragment">New Relic for introspection</li>
					<li class="fragment">Exercised different content types, exceeded TTLs</li>
					<li class="fragment"><a href="https://webpagetest.org">WebPageTest.org</a></li>
				</ul>
			</section>
		</section>
		<section data-state="laback">
			<img src="assets/masthead2logo.png" alt="">
			<h1 class="title end">What did you think?</h1>
			<h4 class="subtitle">Evaluate this session<br/><a style="text-transform: lowercase;font-size: .5em;" href="https://events.drupal.org/losangeles2015/schedule/">events.drupal.org/losangeles2015/schedule/</a></h4>
			<p></p>
			<p class="thankyou">Thank You!</p>
		</section>
	</div>
</div>
<script src="lib/js/head.min.js"></script>
<script src="js/reveal.js"></script>
<script>
	// Full list of configuration options available here:
	// https://github.com/hakimel/reveal.js#configuration
	Reveal.initialize({
		center: true,
		transition: 'linear',
		progress: true
	});
</script>
</body>
</html>
